{% extends "layouts/blocks.html" %}

{% block title %}
    {{title}}    
{% endblock title %}


{% block section %}
<h1>Panel de Control</h1>
<h1>{{section}}</h1>
{% endblock section %}


{% block buscador %}
<span>{% now "Y-m-d H:i" %} </span>
{% endblock buscador %}


{% block subsection %}
    <h2>{{subsection}}</h2>
{% endblock subsection %}


{% block botones %}
    <select id="filter-btn" name="tipo_operacion">
        <option value="" disabled selected>Tipo</option>
        <option value="compra">Compra</option>
        <option value="venta">Venta</option>
    </select>

    <button class="btns" id="add-btn" onclick="window.location.href='{% url 'crear_mat' %}'">AÃ±adir</button>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const filterBtn = document.getElementById('filter-btn');
            const tableRows = document.querySelectorAll('#materials-table tr');
            const purchaseHeader = document.getElementById('price-purchase-header');
            const saleHeader = document.getElementById('price-sale-header');

            filterBtn.addEventListener('change', () => {
                const filterValue = filterBtn.value; 

                tableRows.forEach(row => {
                    if (!filterValue || row.dataset.operation === filterValue) {
                        row.style.display = ''; 
                    } else {
                        row.style.display = 'none'; 
                    }
                });

                if (filterValue === 'compra') {
                    purchaseHeader.textContent = 'Precio Compra Mayorista';
                    saleHeader.textContent = 'Precio Venta Mayorista';
                } else if (filterValue === 'venta') {
                    purchaseHeader.textContent = 'Precio Compra Minorista';
                    saleHeader.textContent = 'Precio Venta Minorista';
                } else {
                    purchaseHeader.textContent = 'Precio Compra';
                    saleHeader.textContent = 'Precio Venta';
                }
            });
        });
    </script>
{% endblock botones %}



{% block content_box %}
{% csrf_token %}
<form method="GET" action="">
    <div class="search">
        <input type="text" name="search" placeholder="Buscar..." value="{{ search_query }}">
        <button type="submit">Buscar</button>
    </div>
</form>

<div class="transactions-container">
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>Material</th>
                    <th>Tipo de Material</th>
                    <th id="price-purchase-header">Precio Compra</th>
                    <th id="price-sale-header">Precio Venta</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="materials-table">
                {% for material in entity %}
                    <tr data-operation="compra">
                        <td>
                            {% if material.image %}
                                <img id="imagen" src="{{ material.image.url }}" alt="{{ material.Material_Type }}" width="100">
                            {% else %}
                                <span class="text-muted">Sin imagen</span>
                            {% endif %}
                        </td>
                        <td>{{ material.Material_Type }}</td>
                        <td>${{ material.Wholesale_Purchase_Price }}</td>
                        <td>${{ material.Wholesale_Sale_Price }}</td>
                        <td>
                            <a href="{% url 'editar_material' material.pk %}" class="btn btn-primary btn-sm">
                                Editar
                            </a>
                        </td>
                    </tr>
                    <tr data-operation="venta">
                        <td>
                            {% if material.image %}
                                <img id="imagen" src="{{ material.image.url }}" alt="{{ material.Material_Type }}" width="100">
                            {% else %}
                                <span class="text-muted">Sin imagen</span>
                            {% endif %}
                        </td>
                        <td>{{ material.Material_Type }}</td>
                        <td>${{ material.Retail_Purchase_Price }}</td>
                        <td>${{ material.Retail_Sale_Price }}</td>
                        <td>
                            <a href="{% url 'editar_material' material.pk %}" class="btn btn-primary btn-sm">
                                Editar
                            </a>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="5" class="text-center">No hay materiales registrados.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
<div>
    {% include "paginator.html" %}
</div>

{% endblock content_box %}
